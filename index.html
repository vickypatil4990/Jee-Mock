<!DOCTYPE html>
<html>
<head>

<link rel="manifest" href="manifest.json">
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>JEE Main Mock Test</title>
<meta name="theme-color" content="#1f1f1f">

<style>
body{margin:0;font-family:Arial;background:#f2f2f2}
header{background:#1f1f1f;color:#fff;padding:12px;text-align:center}
.panel{padding:12px}
.q{background:#fff;padding:10px;margin-bottom:8px;border-radius:5px}
button{width:100%;padding:12px;margin:6px 0;background:#0b57d0;color:#fff;border:none;border-radius:5px}
.timer{font-weight:bold;margin-bottom:8px}
input[type="number"]{width:100%;padding:6px}
.footer{font-size:12px;color:#666;text-align:center;margin:10px}
</style>
</head>

<body>

<header>
<h3>JEE MAIN – FREE MOCK TEST</h3>
</header>

<!-- LOGIN -->
<div id="loginBox" class="panel">
<h3>Login</h3>
<input id="username" placeholder="Enter your name" style="width:100%;padding:8px">
<button onclick="login()">Start</button>
</div>

<!-- APP -->
<div id="app" class="panel" style="display:none">
<button onclick="startTest()">Generate New Test</button>
<p class="timer" id="timer"></p>
<div id="paper"></div>
<button onclick="submit()">Submit Test</button>
<h3 id="result"></h3>
<h3 id="rank"></h3>
<div id="analytics"></div>
</div>

<div class="footer">
Free forever • Unlimited tests • No ads
</div>

<script>
// ---------- LOGIN ----------
let user = localStorage.getItem("user");
if(user){
 document.getElementById("loginBox").style.display="none";
 document.getElementById("app").style.display="block";
}

function login(){
 let u=document.getElementById("username").value;
 if(!u) return alert("Enter name");
 localStorage.setItem("user",u);
 localStorage.setItem("history_"+u,JSON.stringify([]));
 location.reload();
}

// ---------- EXTENDED PYQ-STYLE QUESTION BANK ----------
const DB={
 physics:{
  mcq:[
   {q:"SI unit of force?",o:["Joule","Newton","Pascal","Watt"],a:1},
   {q:"Electric field unit?",o:["N/C","J","W","V"],a:0},
   {q:"Dimensional formula of energy?",o:["ML²T⁻²","MLT⁻²","MT²","ML²"],a:0},
   {q:"Which is a vector quantity?",o:["Speed","Mass","Velocity","Energy"],a:2},
   {q:"Unit of power?",o:["Joule","Watt","Newton","Pascal"],a:1},
   {q:"Work done in circular motion?",o:["Zero","Max","Min","Infinite"],a:0}
  ],
  num:[
   {q:"Value of g (m/s²)?",a:10},
   {q:"Speed of light (×10⁸ m/s)?",a:3},
   {q:"Charge of electron (×10⁻¹⁹ C)?",a:1.6},
   {q:"Gravitational constant order (×10⁻¹¹)?",a:6.67}
  ]
 },

 chemistry:{
  mcq:[
   {q:"Hybridisation of CH₄?",o:["sp","sp²","sp³","dsp²"],a:2},
   {q:"Oxidation state of O in H₂O?",o:["0","-1","-2","+1"],a:2},
   {q:"Strong acid among these?",o:["HCl","CH₃COOH","H₂CO₃","HF"],a:0},
   {q:"Atomicity of O₃?",o:["1","2","3","4"],a:2},
   {q:"Which is noble gas?",o:["N","O","Ne","Cl"],a:2},
   {q:"p-block element?",o:["Na","Mg","Al","Ca"],a:2}
  ],
  num:[
   {q:"Atomic number of Carbon?",a:6},
   {q:"pH of neutral solution?",a:7},
   {q:"Avogadro number (×10²³)?",a:6},
   {q:"Atomic number of Oxygen?",a:8}
  ]
 },

 maths:{
  mcq:[
   {q:"d/dx(x²)?",o:["x","2x","x²","1"],a:1},
   {q:"sin²x + cos²x =",o:["0","1","2","-1"],a:1},
   {q:"Value of log₁₀1?",o:["0","1","10","Undefined"],a:0},
   {q:"If |x|=5, x equals?",o:["5","-5","±5","0"],a:2},
   {q:"Degree of x²+1?",o:["1","2","0","3"],a:1},
   {q:"Roots of x²−1=0?",o:["1","-1","±1","0"],a:2}
  ],
  num:[
   {q:"Value of π (2 decimals)?",a:3.14},
   {q:"|−5| equals?",a:5},
   {q:"Value of 2³?",a:8},
   {q:"10² equals?",a:100}
  ]
 }
};

let paper=[], time, timer;

// ---------- BUILD PAPER ----------
function buildSubject(sub){
 let arr=[];
 while(arr.filter(q=>q.type==="mcq").length<20)
  DB[sub].mcq.forEach(q=>arr.push({...q,type:"mcq"}));
 while(arr.filter(q=>q.type==="num").length<5)
  DB[sub].num.forEach(q=>arr.push({...q,type:"num"}));
 return arr.slice(0,25);
}

// ---------- START TEST ----------
function startTest(){
 paper=[
  ...buildSubject("physics"),
  ...buildSubject("chemistry"),
  ...buildSubject("maths")
 ].sort(()=>Math.random()-0.5);

 document.getElementById("paper").innerHTML="";
 document.getElementById("result").innerText="";
 document.getElementById("rank").innerText="";
 document.getElementById("analytics").innerText="";

 time=180*60;
 clearInterval(timer);
 timer=setInterval(()=>{
  let h=Math.floor(time/3600),
      m=Math.floor((time%3600)/60),
      s=time%60;
  document.getElementById("timer").innerText=
   `Time Left: ${h}:${m}:${s}`;
  if(--time<0) submit();
 },1000);

 render();
}

// ---------- RENDER ----------
function render(){
 const div=document.getElementById("paper");
 paper.forEach((q,i)=>{
  let d=document.createElement("div");
  d.className="q";
  d.innerHTML=`<b>Q${i+1}.</b> ${q.q}<br>`;
  if(q.type==="mcq"){
   q.o.forEach((op,j)=>{
    d.innerHTML+=
     `<input type="radio" name="q${i}" value="${j}"> ${op}<br>`;
   });
  } else {
   d.innerHTML+=`<input type="number" name="q${i}">`;
  }
  div.appendChild(d);
 });
}

// ---------- SUBMIT + ANALYTICS ----------
function submit(){
 clearInterval(timer);
 let score=0;
 let stats={physics:0,chemistry:0,maths:0};

 paper.forEach((q,i)=>{
  let el=document.querySelector(`[name="q${i}"]:checked`)
        ||document.querySelector(`[name="q${i}"]`);
  if(!el||el.value==="") return;

  let subject=i<25?"physics":i<50?"chemistry":"maths";

  if(q.type==="mcq"){
   if(+el.value===q.a){score+=4;stats[subject]++;}
   else score-=1;
  } else {
   if(+el.value===q.a){score+=4;stats[subject]++;}
  }
 });

 let history=JSON.parse(localStorage.getItem("history_"+user))||[];
 history.push({score,stats});
 localStorage.setItem("history_"+user,JSON.stringify(history));

 let percentile=Math.min(99.99,(score/300)*100);
 let rank=Math.max(1,Math.round((100-percentile)*130000));

 document.getElementById("result").innerText=
  `Score: ${score}/300 | Percentile ≈ ${percentile.toFixed(2)}`;
 document.getElementById("rank").innerText=
  `Estimated AIR ≈ ${rank}`;

 showAnalytics(history);
}

// ---------- ANALYTICS ----------
function showAnalytics(history){
 let tests=history.length;
 let avg=Math.round(history.reduce((a,b)=>a+b.score,0)/tests);
 let p=0,c=0,m=0;
 history.forEach(h=>{
  p+=h.stats.physics;
  c+=h.stats.chemistry;
  m+=h.stats.maths;
 });
 document.getElementById("analytics").innerHTML=
 `<h3>Analytics</h3>
 <p>Total Tests: ${tests}</p>
 <p>Average Score: ${avg}/300</p>
 <p>Physics Correct: ${p}</p>
 <p>Chemistry Correct: ${c}</p>
 <p>Maths Correct: ${m}</p>`;
}
</script>

</body>
</html>
